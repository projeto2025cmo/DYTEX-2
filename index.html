<!DOCTYPE html>
<html lang="pt-BR">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>DYTEX - Nutri√ß√£o Personalizada</title>
   
   <!-- PWA Meta Tags -->
   <meta name="theme-color" content="#667eea">
   <meta name="apple-mobile-web-app-capable" content="yes">
   <meta name="apple-mobile-web-app-status-bar-style" content="default">
   <meta name="apple-mobile-web-app-title" content="DYTEX">
   <meta name="description" content="Seu plano personalizado de nutri√ß√£o e exerc√≠cios">
   
   <style>
       * {
           margin: 0;
           padding: 0;
           box-sizing: border-box;
       }

       body {
           font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
           background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
           min-height: 100vh;
           color: #333;
           padding: 20px;
       }

       .container {
           max-width: 1200px;
           margin: 0 auto;
       }

       .header {
           text-align: center;
           margin-bottom: 40px;
           color: white;
       }

       .header h1 {
           font-size: 3rem;
           margin-bottom: 10px;
           text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
       }

       .header p {
           font-size: 1.2rem;
           opacity: 0.9;
       }

       .form-container {
           background: white;
           border-radius: 20px;
           padding: 40px;
           box-shadow: 0 20px 40px rgba(0,0,0,0.1);
           margin-bottom: 30px;
       }

       .form-grid {
           display: grid;
           grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
           gap: 30px;
           margin-bottom: 30px;
       }

       .form-group {
           display: flex;
           flex-direction: column;
       }

       .form-group label {
           font-weight: 600;
           margin-bottom: 8px;
           color: #555;
           font-size: 1.1rem;
       }

       .form-group input, .form-group select {
           padding: 15px;
           border: 2px solid #e1e5e9;
           border-radius: 10px;
           font-size: 1rem;
           transition: all 0.3s ease;
           background: #f8f9fa;
       }

       .form-group input:focus, .form-group select:focus {
           outline: none;
           border-color: #667eea;
           box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
       }

       .btn-generate {
           background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
           color: white;
           border: none;
           padding: 18px 40px;
           font-size: 1.2rem;
           font-weight: 600;
           border-radius: 50px;
           cursor: pointer;
           transition: all 0.3s ease;
           width: 100%;
           box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
       }

       .btn-generate:hover {
           transform: translateY(-3px);
           box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
       }

       .results {
           display: none;
           margin-top: 40px;
       }

       .results.show {
           display: block;
       }

       .plan-section {
           background: white;
           border-radius: 15px;
           padding: 30px;
           margin-bottom: 20px;
           box-shadow: 0 10px 30px rgba(0,0,0,0.1);
           border-left: 5px solid #667eea;
       }

       .plan-section h3 {
           color: #667eea;
           font-size: 1.8rem;
           margin-bottom: 20px;
       }

       .calories-info {
           background: linear-gradient(135deg, #28a745, #20c997);
           color: white;
           padding: 20px;
           border-radius: 15px;
           text-align: center;
           margin-bottom: 20px;
       }

       .calories-info h4 {
           font-size: 1.5rem;
           margin-bottom: 10px;
       }

       .calories-info .number {
           font-size: 2.5rem;
           font-weight: bold;
       }

       .meal-time {
           background: #f8f9fa;
           padding: 20px;
           border-radius: 12px;
           margin-bottom: 20px;
           border-left: 4px solid #28a745;
       }

       .meal-time h4 {
           color: #28a745;
           font-size: 1.3rem;
           margin-bottom: 15px;
           display: flex;
           justify-content: space-between;
           align-items: center;
       }

       .meal-options {
           display: grid;
           grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
           gap: 15px;
           margin-bottom: 15px;
       }

       .meal-option {
           background: white;
           border: 2px solid #e9ecef;
           border-radius: 10px;
           padding: 15px;
           cursor: pointer;
           transition: all 0.3s ease;
           position: relative;
       }

       .meal-option:hover {
           border-color: #667eea;
           transform: translateY(-2px);
           box-shadow: 0 5px 15px rgba(0,0,0,0.1);
       }

       .meal-option.selected {
           border-color: #28a745;
           background: #f8fff9;
           box-shadow: 0 5px 15px rgba(40, 167, 69, 0.2);
       }

       .meal-option.ai-recommended {
           border: 3px solid #ff6b35;
           background: linear-gradient(135deg, #fff8f5 0%, #ffe8e0 100%);
           box-shadow: 0 8px 25px rgba(255, 107, 53, 0.3);
           transform: scale(1.02);
       }

       .meal-option.ai-recommended .ai-badge {
           position: absolute;
           top: -10px;
           left: 50%;
           transform: translateX(-50%);
           background: linear-gradient(135deg, #ff6b35, #f7931e);
           color: white;
           padding: 4px 12px;
           border-radius: 15px;
           font-size: 0.75rem;
           font-weight: bold;
           text-transform: uppercase;
           box-shadow: 0 2px 10px rgba(255, 107, 53, 0.4);
       }

       .meal-option.ai-recommended h5 {
           color: #ff6b35 !important;
           font-weight: bold;
       }

       .meal-option.dimmed {
           opacity: 0.6;
           transform: scale(0.98);
       }

       .meal-option h5 {
           color: #667eea;
           margin-bottom: 10px;
           font-size: 1.1rem;
       }

       .meal-option.selected h5 {
           color: #28a745;
       }

       .food-item {
           padding: 4px 0;
           font-size: 0.9rem;
           color: #666;
       }

       .option-number {
           position: absolute;
           top: -8px;
           right: -8px;
           background: #667eea;
           color: white;
           border-radius: 50%;
           width: 24px;
           height: 24px;
           display: flex;
           align-items: center;
           justify-content: center;
           font-size: 0.8rem;
           font-weight: bold;
       }

       .meal-option.selected .option-number {
           background: #28a745;
       }

       .meal-option.ai-recommended .option-number {
           background: #ff6b35;
       }

       .selected-indicator {
           position: absolute;
           top: 10px;
           right: 10px;
           color: #28a745;
           font-size: 1.2rem;
       }

       .randomize-btn {
           background: #ffc107;
           color: #856404;
           border: none;
           padding: 8px 16px;
           border-radius: 20px;
           cursor: pointer;
           font-size: 0.9rem;
           font-weight: 600;
           transition: all 0.3s ease;
       }

       .randomize-btn:hover {
           background: #ffca2c;
           transform: scale(1.05);
       }

       .exercise-item {
           background: #fff3cd;
           padding: 15px;
           border-radius: 10px;
           margin-bottom: 15px;
           border-left: 4px solid #ffc107;
       }

       .exercise-item h5 {
           color: #856404;
           margin-bottom: 8px;
           font-size: 1.1rem;
       }

       .status {
           background: #d4edda;
           color: #155724;
           padding: 10px 20px;
           border-radius: 10px;
           margin: 20px 0;
           border: 1px solid #c3e6cb;
       }

       .install-prompt {
           background: rgba(255,255,255,0.95);
           padding: 15px 20px;
           border-radius: 15px;
           margin-bottom: 20px;
           text-align: center;
           box-shadow: 0 5px 15px rgba(0,0,0,0.1);
       }

       .install-btn {
           background: #28a745;
           color: white;
           border: none;
           padding: 10px 20px;
           border-radius: 25px;
           cursor: pointer;
           font-weight: 600;
           margin-top: 10px;
       }

       .ai-recommendation {
           background: linear-gradient(135deg, #ff6b35, #f7931e);
           color: white;
           padding: 15px 20px;
           border-radius: 15px;
           margin-bottom: 20px;
           text-align: center;
           box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3);
       }

       .ai-recommendation h4 {
           margin-bottom: 10px;
           font-size: 1.2rem;
       }

       @media (max-width: 768px) {
           .form-grid {
               grid-template-columns: 1fr;
           }
           
           .header h1 {
               font-size: 2rem;
           }
           
           .form-container {
               padding: 20px;
           }

           .meal-options {
               grid-template-columns: 1fr;
           }

           .meal-time h4 {
               flex-direction: column;
               align-items: flex-start;
               gap: 10px;
           }
       }
   </style>
</head>
<body>
   <div class="container">
       <div class="header">
           <h1>ü•ó DYTEX</h1>
           <p>Seu plano personalizado de nutri√ß√£o e exerc√≠cios com IA</p>
       </div>

       <!-- Install App Prompt -->
       <div id="installPrompt" class="install-prompt" style="display: none;">
           <h4>üì± Instalar App</h4>
           <p>Adicione o DYTEX √† sua tela inicial para acesso r√°pido!</p>
           <button class="install-btn" onclick="installApp()">Instalar Agora</button>
       </div>

       <div class="form-container">
           <div class="form-grid">
               <div class="form-group">
                   <label for="age">üë§ Idade (anos)</label>
                   <input type="number" id="age" min="16" max="100" required>
               </div>

               <div class="form-group">
                   <label for="weight">‚öñÔ∏è Peso (kg)</label>
                   <input type="number" id="weight" min="40" max="200" step="0.1" required>
               </div>

               <div class="form-group">
                   <label for="height">üìè Altura (cm)</label>
                   <input type="number" id="height" min="140" max="220" required>
               </div>

               <div class="form-group">
                   <label for="gender">üë• Sexo</label>
                   <select id="gender" required>
                       <option value="">Selecione...</option>
                       <option value="male">Masculino</option>
                       <option value="female">Feminino</option>
                   </select>
               </div>

               <div class="form-group">
                   <label for="wakeTime">üåÖ Hor√°rio que acorda</label>
                   <input type="time" id="wakeTime" required>
               </div>

               <div class="form-group">
                   <label for="sleepTime">üåô Hor√°rio que dorme</label>
                   <input type="time" id="sleepTime" required>
               </div>

               <div class="form-group">
                   <label for="activity">üèÉ N√≠vel de Atividade</label>
                   <select id="activity" required>
                       <option value="">Selecione...</option>
                       <option value="1.2">Sedent√°rio</option>
                       <option value="1.375">Levemente ativo</option>
                       <option value="1.55">Moderadamente ativo</option>
                       <option value="1.725">Muito ativo</option>
                       <option value="1.9">Extremamente ativo</option>
                   </select>
               </div>

               <div class="form-group">
                   <label for="goal">üéØ Objetivo</label>
                   <select id="goal" required>
                       <option value="">Selecione...</option>
                       <option value="lose">Perder peso</option>
                       <option value="maintain">Manter peso</option>
                       <option value="gain">Ganhar peso</option>
                   </select>
               </div>
           </div>

           <button type="button" class="btn-generate" onclick="generatePlan()">
               ‚ú® Gerar Meu Plano Personalizado com IA
           </button>

           <div id="status"></div>
       </div>

       <div id="results" class="results">
           <div class="calories-info">
               <h4>üìä Suas Necessidades Cal√≥ricas</h4>
               <div class="number" id="caloriesNumber">0</div>
               <p>calorias por dia</p>
           </div>

           <div class="ai-recommendation">
               <h4>ü§ñ Recomenda√ß√£o da IA</h4>
               <p id="aiRecommendationText">A IA analisou seu perfil e destacou as melhores op√ß√µes para voc√™!</p>
           </div>

           <div class="plan-section">
               <h3>üçΩÔ∏è Plano Alimentar</h3>
               <p style="margin-bottom: 20px; color: #666;">As op√ß√µes destacadas em laranja s√£o recomendadas pela IA baseado no seu perfil. Clique para escolher ou use o bot√£o "üé≤ Sortear".</p>
               <div id="mealPlan"></div>
           </div>

           <div class="plan-section">
               <h3>üí™ Plano de Exerc√≠cios</h3>
               <div id="exercisePlan"></div>
           </div>
       </div>
   </div>

   <script>
       // ========== VARI√ÅVEIS GLOBAIS ==========
       var deferredPrompt;
       var selectedMeals = {};
       var aiRecommendations = {};

       // ========== BANCO DE DADOS DE REFEI√á√ïES ==========
       var mealOptions = {
           'cafe': [
               {
                   name: 'Energ√©tico Matinal',
                   foods: ['Aveia com frutas (1 tigela)', 'Iogurte natural (1 pote)', 'Banana (1 unidade)', 'Caf√© com leite (1 x√≠cara)']
               },
               {
                   name: 'Proteico Power',
                   foods: ['Ovos mexidos (2 unidades)', 'P√£o integral (2 fatias)', 'Queijo cottage (2 col. sopa)', 'Suco de laranja (200ml)']
               },
               {
                   name: 'Tropical Fresh',
                   foods: ['A√ßa√≠ com granola (1 tigela)', 'Castanhas (20g)', 'Mel (1 col. sopa)', '√Ågua de coco (200ml)']
               },
               {
                   name: 'Fitness Light',
                   foods: ['Smoothie de frutas (300ml)', 'Tapioca com queijo (1 unidade)', 'Chia (1 col. sopa)', 'Ch√° verde (1 x√≠cara)']
               },
               {
                   name: 'Tradicional Brasileiro',
                   foods: ['P√£o franc√™s (2 unidades)', 'Manteiga (1 col. sopa)', 'Presunto magro (2 fatias)', 'Caf√© preto (1 x√≠cara)']
               },
               {
                   name: 'Vegano Nutritivo',
                   foods: ['Leite de aveia (200ml)', 'Granola sem a√ß√∫car (3 col. sopa)', 'Frutas vermelhas (1 x√≠cara)', 'Pasta de amendoim (1 col. sopa)']
               },
               {
                   name: 'Low Carb Matinal',
                   foods: ['Omelete com espinafre (2 ovos)', 'Abacate (1/2 unidade)', 'Queijo branco (2 fatias)', 'Ch√° de ervas (1 x√≠cara)']
               },
               {
                   name: 'Detox Natural',
                   foods: ['Suco verde (300ml)', 'P√£o integral (1 fatia)', 'Ricota (2 col. sopa)', 'Tomate cereja (5 unidades)']
               },
               {
                   name: 'Mediterr√¢neo',
                   foods: ['Iogurte grego (1 pote)', 'Nozes (30g)', 'Mel (1 col. ch√°)', 'Frutas secas (2 col. sopa)']
               },
               {
                   name: 'Energ√©tico Esportista',
                   foods: ['Whey protein (1 scoop)', 'Banana (1 unidade)', 'Aveia (3 col. sopa)', 'Leite desnatado (200ml)']
               }
           ],
           'lanche_manha': [
               {
                   name: 'Mix Nutricional',
                   foods: ['Castanhas mistas (30g)', 'Ma√ß√£ (1 unidade)']
               },
               {
                   name: 'Prote√≠na Vegetal',
                   foods: ['Iogurte grego (1 pote)', 'Granola (2 col. sopa)']
               },
               {
                   name: 'Hidratante Natural',
                   foods: ['√Ågua de coco (200ml)', 'Biscoito integral (3 unidades)']
               },
               {
                   name: 'Energia R√°pida',
                   foods: ['Banana com aveia (1 unidade)', 'Amendoim (15g)']
               },
               {
                   name: 'Frutas Tropicais',
                   foods: ['Mam√£o papaya (1 fatia)', 'Iogurte natural (1 pote)']
               },
               {
                   name: 'Antioxidante',
                   foods: ['Frutas vermelhas (1 x√≠cara)', 'Castanha do Par√° (5 unidades)']
               },
               {
                   name: 'Fibras Naturais',
                   foods: ['Pera (1 unidade)', 'Queijo cottage (2 col. sopa)']
               },
               {
                   name: 'Energia Vegana',
                   foods: ['T√¢maras (3 unidades)', 'Am√™ndoas (20g)']
               },
               {
                   name: 'Hidrata√ß√£o Plus',
                   foods: ['Melancia (2 fatias)', '√Ågua com lim√£o (300ml)']
               },
               {
                   name: 'Prote√≠na Animal',
                   foods: ['Ovo cozido (1 unidade)', 'Tomate cereja (8 unidades)']
               }
           ],
           'almoco': [
               {
                   name: 'Brasileiro Completo',
                   foods: ['Arroz integral (4 col. sopa)', 'Feij√£o (1 concha)', 'Frango grelhado (120g)', 'Salada verde (1 prato)', 'Br√≥colis (3 col. sopa)']
               },
               {
                   name: 'Mediterr√¢neo',
                   foods: ['Quinoa (4 col. sopa)', 'Gr√£o-de-bico (1 concha)', 'Salm√£o grelhado (120g)', 'Salada colorida (1 prato)', 'Azeite extra virgem (1 col. sopa)']
               },
               {
                   name: 'Low Carb Power',
                   foods: ['Couve-flor refogada (4 col. sopa)', 'Lentilha (1 concha)', 'Carne vermelha magra (120g)', 'R√∫cula (1 prato)', 'Abacate (1/4 unidade)']
               },
               {
                   name: 'Oriental Fusion',
                   foods: ['Arroz cateto (4 col. sopa)', 'Miss√¥ (1 tigela)', 'Tofu grelhado (120g)', 'Legumes no vapor (1 prato)', 'Algas (1 col. sopa)']
               },
               {
                   name: 'Massa Integral',
                   foods: ['Macarr√£o integral (1 prato)', 'Molho de tomate (3 col. sopa)', 'Peito de peru (100g)', 'Salada mista (1 prato)', 'Parmes√£o (1 col. sopa)']
               },
               {
                   name: 'Peixe Tropical',
                   foods: ['Arroz de coco (4 col. sopa)', 'Feij√£o verde (1 concha)', 'Peixe assado (120g)', 'Salada de manga (1 prato)', 'Coco ralado (1 col. sopa)']
               },
               {
                   name: 'Vegano Completo',
                   foods: ['Arroz integral (4 col. sopa)', 'Feij√£o preto (1 concha)', 'Tempeh grelhado (100g)', 'Salada colorida (1 prato)', 'Tahine (1 col. sopa)']
               },
               {
                   name: 'Fitness Gourmet',
                   foods: ['Batata doce (1 unidade)', 'Ervilha (1 concha)', 'Peito de frango (150g)', 'Aspargos (8 unidades)', 'Azeite (1 col. ch√°)']
               },
               {
                   name: 'Tradicional Mineiro',
                   foods: ['Arroz branco (4 col. sopa)', 'Feij√£o tropeiro (1 concha)', 'Lombo su√≠no (100g)', 'Couve refogada (3 col. sopa)', 'Farinha de mandioca (1 col. sopa)']
               },
               {
                   name: 'Funcional Detox',
                   foods: ['Quinoa com legumes (1 prato)', 'Sopa de miso (1 tigela)', 'Salm√£o selvagem (120g)', 'Salada de folhas verdes (1 prato)', '√ìleo de coco (1 col. ch√°)']
               }
           ],
           'lanche_tarde': [
               {
                   name: 'Vitamina Power',
                   foods: ['Vitamina de frutas (200ml)', 'Biscoito integral (3 unidades)']
               },
               {
                   name: 'Prote√≠na Cremosa',
                   foods: ['Vitamina de whey protein (200ml)', 'Banana (1 unidade)']
               },
               {
                   name: 'Fibras & Energia',
                   foods: ['Iogurte com fibras (1 pote)', 'Frutas vermelhas (1 x√≠cara)']
               },
               {
                   name: 'Hidratante Doce',
                   foods: ['√Ågua saborizada (300ml)', 'Barra de cereal (1 unidade)']
               },
               {
                   name: 'Tropical Refrescante',
                   foods: ['Smoothie de manga (250ml)', 'Coco seco (2 col. sopa)']
               },
               {
                   name: 'Caf√© Gourmet',
                   foods: ['Caf√© com leite (200ml)', 'Biscoito de aveia (2 unidades)']
               },
               {
                   name: 'Antioxidante Natural',
                   foods: ['Ch√° verde (300ml)', 'Mix de frutas secas (30g)']
               },
               {
                   name: 'Prote√≠na Vegetal',
                   foods: ['Leite de am√™ndoas (200ml)', 'Cookies integrais (2 unidades)']
               },
               {
                   name: 'Energ√©tico Natural',
                   foods: ['Suco de uva integral (200ml)', 'Castanhas variadas (25g)']
               },
               {
                   name: 'Digestivo Leve',
                   foods: ['Ch√° de camomila (300ml)', 'Torrada integral (2 unidades)']
               }
           ],
           'jantar': [
               {
                   name: 'Peixe Gourmet',
                   foods: ['Salm√£o grelhado (100g)', 'Batata doce (1 unidade)', 'Aspargos (6 unidades)', 'Salada (1 prato)']
               },
               {
                   name: 'Vegetariano Light',
                   foods: ['Tofu marinado (100g)', 'Pur√™ de ab√≥bora (3 col. sopa)', 'Couve refogada (3 col. sopa)', 'Salada de folhas (1 prato)']
               },
               {
                   name: 'Carne & Legumes',
                   foods: ['Frango assado (100g)', 'Abobrinha refogada (4 col. sopa)', 'Cenoura no vapor (3 col. sopa)', 'R√∫cula (1 prato)']
               },
               {
                   name: 'Detox Noturno',
                   foods: ['Peixe branco (100g)', 'Salada de pepino (1 prato)', 'Tomate cereja (10 unidades)', 'Ch√° digestivo (1 x√≠cara)']
               },
               {
                   name: 'Mediterr√¢neo Leve',
                   foods: ['Bacalhau grelhado (100g)', 'Azeite de oliva (1 col. ch√°)', 'Salada grega (1 prato)', 'Azeitonas (8 unidades)']
               },
               {
                   name: 'Asi√°tico Saud√°vel',
                   foods: ['Frango teriyaki (100g)', 'Br√≥colis no vapor (4 col. sopa)', 'Cogumelos shitake (3 col. sopa)', 'Salada oriental (1 prato)']
               },
               {
                   name: 'Brasileira Fit',
                   foods: ['Peixe pintado (100g)', 'Mandioquinha (2 unidades)', 'Quiabo refogado (3 col. sopa)', 'Salada de almeir√£o (1 prato)']
               },
               {
                   name: 'Low Carb Noturno',
                   foods: ['Carne magra (100g)', 'Salada verde (1 prato)', 'Palmito (4 col. sopa)', 'Pepino (1/2 unidade)']
               },
               {
                   name: 'Vegano Equilibrado',
                   foods: ['Gr√£o-de-bico assado (1 concha)', 'Quinoa (3 col. sopa)', 'Espinafre refogado (4 col. sopa)', 'Salada colorida (1 prato)']
               },
               {
                   name: 'Digestivo Leve',
                   foods: ['Peito de peru (80g)', 'Chuchu refogado (4 col. sopa)', 'Vagem no vapor (3 col. sopa)', 'Salada de folhas (1 prato)']
               }
           ]
       };

       // ========== FUN√á√ïES AUXILIARES ==========
       function showStatus(message, isError) {
           var statusDiv = document.getElementById('status');
           statusDiv.innerHTML = message;
           statusDiv.style.background = isError ? '#f8d7da' : '#d4edda';
           statusDiv.style.color = isError ? '#721c24' : '#155724';
           statusDiv.style.display = 'block';
       }

       function installApp() {
           if (deferredPrompt) {
               deferredPrompt.prompt();
               deferredPrompt.userChoice.then(function(choiceResult) {
                   if (choiceResult.outcome === 'accepted') {
                       console.log('App instalado!');
                   }
                   deferredPrompt = null;
                   document.getElementById('installPrompt').style.display = 'none';
               });
           }
       }

       // ========== SISTEMA DE IA ==========
       function getAIRecommendation(goal, activityLevel, gender, age) {
           var recommendations = {
               cafe: 0,
               lanche_manha: 0,
               almoco: 0,
               lanche_tarde: 0,
               jantar: 0
           };

           // L√≥gica de recomenda√ß√£o baseada no objetivo
           if (goal === 'lose') {
               recommendations.cafe = Math.random() < 0.7 ? 3 : 6; // Fitness Light ou Low Carb
               recommendations.lanche_manha = Math.random() < 0.6 ? 2 : 8; // Hidratante ou Hidrata√ß√£o Plus
               recommendations.almoco = Math.random() < 0.8 ? 2 : 7; // Low Carb Power ou Fitness Gourmet
               recommendations.lanche_tarde = Math.random() < 0.7 ? 3 : 6; // Hidratante Doce ou Antioxidante
               recommendations.jantar = Math.random() < 0.8 ? 3 : 7; // Detox Noturno ou Low Carb Noturno
           } else if (goal === 'gain') {
               recommendations.cafe = Math.random() < 0.8 ? 9 : 1; // Energ√©tico Esportista ou Proteico Power
               recommendations.lanche_manha = Math.random() < 0.7 ? 1 : 9; // Prote√≠na Vegetal ou Prote√≠na Animal
               recommendations.almoco = Math.random() < 0.6 ? 0 : 7; // Brasileiro Completo ou Fitness Gourmet
               recommendations.lanche_tarde = Math.random() < 0.8 ? 1 : 8; // Prote√≠na Cremosa ou Energ√©tico Natural
               recommendations.jantar = Math.random() < 0.7 ? 0 : 5; // Peixe Gourmet ou Asi√°tico Saud√°vel
           } else { // maintain
               recommendations.cafe = Math.random() < 0.5 ? 0 : 8; // Energ√©tico Matinal ou Mediterr√¢neo
               recommendations.lanche_manha = Math.random() < 0.6 ? 0 : 5; // Mix Nutricional ou Antioxidante
               recommendations.almoco = Math.random() < 0.4 ? 0 : 1; // Brasileiro Completo ou Mediterr√¢neo
               recommendations.lanche_tarde = Math.random() < 0.5 ? 0 : 2; // Vitamina Power ou Fibras & Energia
               recommendations.jantar = Math.random() < 0.6 ? 0 : 4; // Peixe Gourmet ou Mediterr√¢neo Leve
           }

           // Ajustes baseados no n√≠vel de atividade
           if (parseFloat(activityLevel) >= 1.725) { // Muito ativo ou extremamente ativo
               recommendations.cafe = Math.random() < 0.7 ? 9 : recommendations.cafe; // Energ√©tico Esportista
               recommendations.lanche_tarde = Math.random() < 0.6 ? 1 : recommendations.lanche_tarde; // Prote√≠na Cremosa
           }

           // Ajustes baseados no g√™nero
           if (gender === 'female') {
               recommendations.lanche_manha = Math.random() < 0.6 ? 5 : recommendations.lanche_manha; // Antioxidante
               recommendations.jantar = Math.random() < 0.5 ? 3 : recommendations.jantar; // Detox Noturno
           }

           return recommendations;
       }

       function updateAIRecommendationText(goal, activity) {
           var goalTexts = {
               lose: 'focando em op√ß√µes com menos calorias e mais nutrientes',
               maintain: 'priorizando o equil√≠brio nutricional',
               gain: 'selecionando op√ß√µes com mais prote√≠nas e calorias'
           };

           var activityTexts = {
               '1.2': 'adequadas para seu estilo de vida sedent√°rio',
               '1.375': 'ideais para sua rotina levemente ativa',
               '1.55': 'perfeitas para seu n√≠vel moderado de atividade',
               '1.725': 'otimizadas para seu alto n√≠vel de atividade',
               '1.9': 'especializadas para atletas como voc√™'
           };

           var text = 'A IA analisou seu perfil ' + goalTexts[goal] + ' e selecionou refei√ß√µes ' + (activityTexts[activity] || 'adequadas ao seu perfil') + '!';
           document.getElementById('aiRecommendationText').textContent = text;
       }

       // ========== FUN√á√ÉO PRINCIPAL ==========
       function generatePlan() {
           console.log('üöÄ Fun√ß√£o generatePlan executada!');
           showStatus('‚è≥ Gerando seu plano personalizado com IA...');

           // Coletar dados do formul√°rio
           var age = document.getElementById('age').value;
           var weight = document.getElementById('weight').value;
           var height = document.getElementById('height').value;
           var gender = document.getElementById('gender').value;
           var wakeTime = document.getElementById('wakeTime').value;
           var sleepTime = document.getElementById('sleepTime').value;
           var activity = document.getElementById('activity').value;
           var goal = document.getElementById('goal').value;

           console.log('üìã Dados coletados:', { age: age, weight: weight, height: height, gender: gender, wakeTime: wakeTime, sleepTime: sleepTime, activity: activity, goal: goal });

           // Validar campos obrigat√≥rios
           if (!age || !weight || !height || !gender || !wakeTime || !sleepTime || !activity || !goal) {
               showStatus('‚ö†Ô∏è Por favor, preencha todos os campos!', true);
               return;
           }

           try {
               // Calcular TMB (Taxa Metab√≥lica Basal)
               var bmr;
               if (gender === 'male') {
                   bmr = 88.362 + (13.397 * parseFloat(weight)) + (4.799 * parseFloat(height)) - (5.677 * parseInt(age));
               } else {
                   bmr = 447.593 + (9.247 * parseFloat(weight)) + (3.098 * parseFloat(height)) - (4.330 * parseInt(age));
               }

               console.log('üìä TMB calculado:', bmr);

               // Aplicar fator de atividade
               var calories = bmr * parseFloat(activity);

               // Ajustar baseado no objetivo
               if (goal === 'lose') {
                   calories -= 500; // D√©ficit para perda de peso
               } else if (goal === 'gain') {
                   calories += 500; // Super√°vit para ganho de peso
               }

               // Aplicar limite m√≠nimo de 1000 kcal
               if (calories < 1000) {
                   calories = 1000;
                   showStatus('‚ö†Ô∏è Calorias ajustadas para o m√≠nimo seguro de 1000 kcal por dia.');
               }

               calories = Math.round(calories);
               console.log('üî• Calorias finais:', calories);

               // Resetar sele√ß√µes anteriores
               selectedMeals = {};

               // Gerar recomenda√ß√µes da IA
               aiRecommendations = getAIRecommendation(goal, activity, gender, age);
               console.log('ü§ñ Recomenda√ß√µes da IA:', aiRecommendations);

               // Atualizar texto da recomenda√ß√£o da IA
               updateAIRecommendationText(goal, activity);

               // Gerar planos
               var mealPlan = createMealPlan(wakeTime, sleepTime, calories);
               var exercisePlan = createExercisePlan(activity, goal);

               // Exibir resultados
               document.getElementById('caloriesNumber').textContent = calories;
               document.getElementById('mealPlan').innerHTML = mealPlan;
               document.getElementById('exercisePlan').innerHTML = exercisePlan;
               
               document.getElementById('results').classList.add('show');
               showStatus('‚úÖ Plano gerado com sucesso pela IA!');
               
               // Scroll suave para os resultados
               setTimeout(function() {
                   document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
               }, 500);

               console.log('‚úÖ Plano gerado e exibido com sucesso!');

           } catch (error) {
               console.error('‚ùå Erro ao gerar plano:', error);
               showStatus('‚ùå Erro ao gerar o plano. Tente novamente.', true);
           }
       }

       // ========== FUN√á√ïES DE CRIA√á√ÉO DE PLANOS ==========
       function createMealPlan(wakeTime, sleepTime, totalCalories) {
           console.log('üçΩÔ∏è Criando plano alimentar...');

           // Calcular hor√°rios das refei√ß√µes baseado no hor√°rio de acordar
           var wakeTimeParts = wakeTime.split(':');
           var wakeHour = parseInt(wakeTimeParts[0]);
           var wakeMin = parseInt(wakeTimeParts[1]);
           var wakeMinutes = wakeHour * 60 + wakeMin;

           var meals = [
               { key: 'cafe', name: 'Caf√© da Manh√£', offset: 30, calories: Math.round(totalCalories * 0.25) },
               { key: 'lanche_manha', name: 'Lanche da Manh√£', offset: 180, calories: Math.round(totalCalories * 0.15) },
               { key: 'almoco', name: 'Almo√ßo', offset: 300, calories: Math.round(totalCalories * 0.35) },
               { key: 'lanche_tarde', name: 'Lanche da Tarde', offset: 480, calories: Math.round(totalCalories * 0.15) },
               { key: 'jantar', name: 'Jantar', offset: 660, calories: Math.round(totalCalories * 0.10) }
           ];

           return meals.map(function(meal) {
               var mealMinutes = wakeMinutes + meal.offset;
               var mealHour = Math.floor(mealMinutes / 60) % 24;
               var mealMin = mealMinutes % 60;
               var timeString = (mealHour < 10 ? '0' : '') + mealHour + ':' + (mealMin < 10 ? '0' : '') + mealMin;

               var options = mealOptions[meal.key];
               var aiRecommendedIndex = aiRecommendations[meal.key];
               
               var optionsHtml = options.map(function(option, index) {
                   var isAIRecommended = index === aiRecommendedIndex;
                   var aiClass = isAIRecommended ? 'ai-recommended' : 'dimmed';
                   var aiBadge = isAIRecommended ? '<div class="ai-badge">ü§ñ IA Recomenda</div>' : '';
                   
                   return '<div class="meal-option ' + aiClass + '" onclick="selectMealOption(\'' + meal.key + '\', ' + index + ')" id="' + meal.key + '_' + index + '">' +
                       '<div class="option-number">' + (index + 1) + '</div>' +
                       aiBadge +
                       '<h5>' + option.name + '</h5>' +
                       option.foods.map(function(food) { return '<div class="food-item">' + food + '</div>'; }).join('') +
                       '</div>';
               }).join('');

               return '<div class="meal-time">' +
                   '<h4>' + meal.name + ' - ' + timeString +
                   '<button class="randomize-btn" onclick="randomizeMeal(\'' + meal.key + '\')">üé≤ Sortear</button>' +
                   '</h4>' +
                   '<div class="meal-options" id="' + meal.key + '_options">' +
                   optionsHtml +
                   '</div>' +
                   '<p style="margin-top: 15px;"><strong>Meta cal√≥rica: ' + meal.calories + ' kcal</strong></p>' +
                   '</div>';
           }).join('');
       }

       function selectMealOption(mealKey, optionIndex) {
           // Remove sele√ß√£o anterior
           var previousSelected = document.querySelector('#' + mealKey + '_options .meal-option.selected');
           if (previousSelected) {
               previousSelected.classList.remove('selected');
               var indicator = previousSelected.querySelector('.selected-indicator');
               if (indicator) indicator.remove();
           }

           // Remove efeito dimmed de todas as op√ß√µes
           var allOptions = document.querySelectorAll('#' + mealKey + '_options .meal-option');
           for (var i = 0; i < allOptions.length; i++) {
               allOptions[i].classList.remove('dimmed');
           }

           // Adiciona nova sele√ß√£o
           var newSelected = document.getElementById(mealKey + '_' + optionIndex);
           newSelected.classList.add('selected');
           
           // Adiciona indicador visual
           var indicator = document.createElement('div');
           indicator.className = 'selected-indicator';
           indicator.innerHTML = '‚úì';
           newSelected.appendChild(indicator);

           // Reaplica efeito dimmed nas op√ß√µes n√£o selecionadas
           for (var i = 0; i < allOptions.length; i++) {
               if (i !== optionIndex && !allOptions[i].classList.contains('ai-recommended')) {
                   allOptions[i].classList.add('dimmed');
               }
           }

           // Salva a sele√ß√£o
           selectedMeals[mealKey] = optionIndex;
           console.log('üçΩÔ∏è Refei√ß√£o selecionada:', mealKey, optionIndex);
       }

       function randomizeMeal(mealKey) {
           var optionsContainer = document.getElementById(mealKey + '_options');
           var options = optionsContainer.querySelectorAll('.meal-option');
           var randomIndex = Math.floor(Math.random() * options.length);
           
           selectMealOption(mealKey, randomIndex);
           
           // Efeito visual de "sorteio"
           for (var i = 0; i < options.length; i++) {
               (function(index) {
                   options[index].style.transform = 'scale(0.95)';
                   setTimeout(function() {
                       options[index].style.transform = 'scale(1)';
                       if (index === randomIndex) {
                           options[index].style.transform = 'scale(1.05)';
                           setTimeout(function() {
                               options[index].style.transform = 'scale(1)';
                           }, 200);
                       }
                   }, 50 * index);
               })(i);
           }
       }

       function createExercisePlan(activityLevel, goal) {
           console.log('üí™ Criando plano de exerc√≠cios...');

           var activityPlans = {
               '1.2': [ // Sedent√°rio
                   { name: 'Caminhada leve', duration: '20-30 min', frequency: '3x por semana' },
                   { name: 'Alongamento', duration: '10-15 min', frequency: 'Diariamente' },
                   { name: 'Exerc√≠cios respirat√≥rios', duration: '5-10 min', frequency: 'Diariamente' }
               ],
               '1.375': [ // Levemente ativo
                   { name: 'Caminhada r√°pida', duration: '30-40 min', frequency: '4x por semana' },
                   { name: 'Exerc√≠cios funcionais', duration: '20-30 min', frequency: '2x por semana' },
                   { name: 'Yoga/Pilates', duration: '45 min', frequency: '2x por semana' }
               ],
               '1.55': [ // Moderadamente ativo
                   { name: 'Corrida leve', duration: '30-40 min', frequency: '3x por semana' },
                   { name: 'Muscula√ß√£o', duration: '45-60 min', frequency: '3x por semana' },
                   { name: 'Nata√ß√£o', duration: '30-45 min', frequency: '2x por semana' }
               ],
               '1.725': [ // Muito ativo
                   { name: 'Corrida moderada', duration: '40-50 min', frequency: '4x por semana' },
                   { name: 'Treino de for√ßa', duration: '60-90 min', frequency: '4x por semana' },
                   { name: 'HIIT', duration: '20-30 min', frequency: '2x por semana' }
               ],
               '1.9': [ // Extremamente ativo
                   { name: 'Corrida intensa', duration: '45-60 min', frequency: '5x por semana' },
                   { name: 'Treino avan√ßado', duration: '90-120 min', frequency: '5x por semana' },
                   { name: 'Treino espec√≠fico', duration: '60-90 min', frequency: '3x por semana' }
               ]
           };

           var exercises = activityPlans[activityLevel] || activityPlans['1.375'];

           return exercises.map(function(exercise) {
               return '<div class="exercise-item">' +
                   '<h5>' + exercise.name + '</h5>' +
                   '<p><strong>Dura√ß√£o:</strong> ' + exercise.duration + '</p>' +
                   '<p><strong>Frequ√™ncia:</strong> ' + exercise.frequency + '</p>' +
                   '</div>';
           }).join('');
       }

       // ========== INICIALIZA√á√ÉO ==========
       window.addEventListener('beforeinstallprompt', function(e) {
           e.preventDefault();
           deferredPrompt = e;
           document.getElementById('installPrompt').style.display = 'block';
       });

       // Service Worker para PWA
       if ('serviceWorker' in navigator) {
           window.addEventListener('load', function() {
               var swCode = 'const CACHE_NAME = "dytex-v1"; const urlsToCache = ["/"]; self.addEventListener("install", (event) => { event.waitUntil(caches.open(CACHE_NAME).then((cache) => cache.addAll(urlsToCache))); }); self.addEventListener("fetch", (event) => { event.respondWith(caches.match(event.request).then((response) => response || fetch(event.request))); });';
               var blob = new Blob([swCode], { type: 'application/javascript' });
               var swUrl = URL.createObjectURL(blob);
               
               navigator.serviceWorker.register(swUrl)
                   .then(function() { console.log('SW registrado'); })
                   .catch(function() { console.log('SW falhou'); });
           });
       }

       // Inicializa√ß√£o quando a p√°gina carrega
       document.addEventListener('DOMContentLoaded', function() {
           console.log('üéØ JavaScript carregado com sucesso!');
           showStatus('üì± Sistema com IA carregado - preencha os campos e clique no bot√£o!');
       });
   </script>
</body>
</html>
